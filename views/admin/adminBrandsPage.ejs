<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Head Boiler Plate -->
    <%- include('components/headerboilerplate') %>
  </head>
  <body class="mr-0">
    <div class="flex">
      <!-- Sidebar Section -->
      <div class="w-2/12 fixed h-full">
        <%- include('components/sidebar') %>
      </div>

    <!-- Confirmation Modal for block user-->
    <div
      id="confirmationModal"
      class="hidden fixed inset-0 p-4 flex flex-wrap justify-center items-center w-full h-full z-[1000] before:fixed before:inset-0 before:w-full before:h-full before:bg-[rgba(0,0,0,0.5)] overflow-auto font-[sans-serif]"
    >
      <div class="w-full max-w-md bg-white shadow-lg rounded-xl p-6 relative">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="w-3.5 cursor-pointer shrink-0 fill-gray-400 hover:fill-red-500 float-right close-modal"
          viewBox="0 0 320.591 320.591"
        >
          <path
            d="M30.391 318.583a30.37 30.37 0 0 1-21.56-7.288c-11.774-11.844-11.774-30.973 0-42.817L266.643 10.665c12.246-11.459 31.462-10.822 42.921 1.424 10.362 11.074 10.966 28.095 1.414 39.875L51.647 311.295a30.366 30.366 0 0 1-21.256 7.288z"
            data-original="#000000"
          ></path>
          <path
            d="M287.9 318.583a30.37 30.37 0 0 1-21.257-8.806L8.83 51.963C-2.078 39.225-.595 20.055 12.143 9.146c11.369-9.736 28.136-9.736 39.504 0l259.331 257.813c12.243 11.462 12.876 30.679 1.414 42.922-.456.487-.927.958-1.414 1.414a30.368 30.368 0 0 1-23.078 7.288z"
            data-original="#000000"
          ></path>
        </svg>

        <div class="my-8 text-center">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-14 fill-red-500 inline"
            viewBox="0 0 286.054 286.054"
          >
            <path
              fill="#e2574c"
              d="M143.027 0C64.04 0 0 64.04 0 143.027c0 78.996 64.04 143.027 143.027 143.027 78.996 0 143.027-64.022 143.027-143.027C286.054 64.04 222.022 0 143.027 0zm0 259.236c-64.183 0-116.209-52.026-116.209-116.209S78.844 26.818 143.027 26.818s116.209 52.026 116.209 116.209-52.026 116.209-116.209 116.209zm.009-196.51c-10.244 0-17.995 5.346-17.995 13.981v79.201c0 8.644 7.75 13.972 17.995 13.972 9.994 0 17.995-5.551 17.995-13.972V76.707c-.001-8.43-8.001-13.981-17.995-13.981zm0 124.997c-9.842 0-17.852 8.01-17.852 17.86 0 9.833 8.01 17.843 17.852 17.843s17.843-8.01 17.843-17.843c-.001-9.851-8.001-17.86-17.843-17.86z"
              data-original="#e2574c"
            />
          </svg>

          <h4 class="text-lg text-gray-800 font-semibold mt-6">
            Are you sure want to block this brand?
          </h4>
          <p class="text-sm text-gray-500 mt-2">Are you sure to proceed?</p>
        </div>

        <div class="flex max-sm:flex-col gap-4">
          <button
            id="cancelButton"
            type="button"
            class="px-5 py-2.5 rounded-lg w-full tracking-wide text-gray-800 text-sm border-none outline-none bg-gray-200 hover:bg-gray-300"
          >
            Cancel
          </button>
          <button
            id="confirmButton"
            type="button"
            class="px-5 py-2.5 rounded-lg w-full tracking-wide text-white text-sm border-none outline-none bg-red-500 hover:bg-red-600"
          >
            Confirm
          </button>
        </div>
      </div>
    </div>

    <!-- Confirmation Modal for block user-->
    <div
      id="unblockconfirmationModal"
      class="hidden fixed inset-0 p-4 flex flex-wrap justify-center items-center w-full h-full z-[1000] before:fixed before:inset-0 before:w-full before:h-full before:bg-[rgba(0,0,0,0.5)] overflow-auto font-[sans-serif]"
    >
      <div class="w-full max-w-md bg-white shadow-lg rounded-xl p-6 relative">
        <div class="my-8 text-center">
          <h4 class="text-lg text-gray-800 font-semibold mt-6">
            Are you sure want to Unblock this brand?
          </h4>
          <p class="text-sm text-gray-500 mt-2">Are you sure to proceed?</p>
        </div>

        <div class="flex max-sm:flex-col gap-4">
          <button
            id="unblockcancelButton"
            type="button"
            class="px-5 py-2.5 rounded-lg w-full tracking-wide text-gray-800 text-sm border-none outline-none bg-gray-200 hover:bg-gray-300"
          >
            Cancel
          </button>
          <button
            id="unblockconfirmButton"
            type="button"
            class="px-5 py-2.5 rounded-lg w-full tracking-wide text-white text-sm border-none outline-none bg-green-500 hover:bg-green-600"
          >
            Confirm
          </button>
        </div>
      </div>
    </div>

      <!-- Content Section -->
      <div class="flex-grow ml-[16.6667%]">
        <!-- Navbar Section -->
        <%- include('components/navbar') %>

        <main class="flex flex-col flex-grow">
          <div class="ml-3 mt-3 items-end">
            <h2 class="text-xl font-bold">Brands Management</h2>
          </div>

          <section class="p-3 sm:p-5 max-w-screen">
            <div class="mx-auto max-w-screen px-4 lg:px-12">
              <div
                class="bg-slate-200 relative shadow-md sm:rounded-lg overflow-hidden"
              >
                <div class="overflow-x-auto">
                  <table
                    class="w-full text-sm text-center shadow-2xl shadow-black text-gray-500"
                  >
                    <thead class="text-xs text-white uppercase bg-gray-600">
                      <tr>
                        <th scope="col" class="px-4 py-3">Brand Name</th>
                        <th scope="col" class="px-4 py-3">Models</th>
                        <th scope="col" class="px-4 py-3">Inventory</th>
                        <th scope="col" class="px-4 py-3">Status</th>
                        <th scope="col" class="px-4 py-3">Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      <% for ( let i = 0; i < brandsCategory.length; i++ ) { %>
                        <td class="px-4 py-3 text-black"><%=brandsCategory[i].brand_name%></td>
                        
                        <td class="px-4 text-black text-start">
                        <% for ( let j = 0; j < brandsCategory[i].products.length; j++
                        ) { %>
                          <li><%=brandsCategory[i].products[j].product_name%></li>
                          <% } %>
                        </td>
                        <td class="px-4 py-3 text-black">
                          <% for ( let k = 0; k < brandsCategory[i].products.length; k++
                          ) { %>
                          <li><%=brandsCategory[i].products[k].product_quantity%></li>
                          <% } %>
                        </td>
                        <% if ( brandsCategory[i].isBlocked === true ) { %>
                        <td class="px-4 py-3 text-black">Blocked</td>
                        <% } else { %>
                        <td class="px-4 py-3 text-black">Unblocked</td>
                        <% } %>
                        <td
                          class="px-4 py-4 text-black flex flex-col lg:flex-row items-center justify-center"
                        >
                          <button 
                            class="text-blue-600 mr-4"
                            onclick="confirmUnblock('<%=brandsCategory[i]._id%>')" 
                          >
                            Unblock
                          </button>
                          <button
                            class="text-red-600 delete-btn"
                            onclick="confirmBlock('<%=brandsCategory[i]._id%>')"
                          >
                            Block
                          </button>
                        </td>
                      </tr>
                      <% } %>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </section>
        </main>
      </div>
    </div>

    <!-- Pagination Controls
    <div class="flex justify-center mb-6">
      <% if (currentPage > 1) { %>
      <a
        href="/admin/customersPage?page=<%= currentPage - 1 %>&limit=10"
        class="px-4 py-2 bg-gray-300 text-gray-800 rounded mx-1"
        >Previous</a
      >
      <% } %> <% for (let i = 1; i <= totalPages; i++) { %>
      <a
        href="/admin/customersPage?page=<%= i %>&limit=10"
        class="px-4 py-2 <%= currentPage === i ? 'bg-blue-500 text-white' : 'bg-gray-300 text-gray-800' %> rounded mx-1"
        ><%= i %></a
      >
      <% } %> <% if (currentPage < totalPages) { %>
      <a
        href="/admin/customersPage?page=<%= currentPage + 1 %>&limit=10"
        class="px-4 py-2 bg-gray-300 text-gray-800 rounded mx-1"
        >Next</a
      >
      <% } %>
    </div> -->

    <script>
      const confirmBlock = (customerId) => {
        const modal = document.getElementById("confirmationModal");
        const confirmButton = document.getElementById("confirmButton");
        const cancelButton = document.getElementById("cancelButton");
        const closeModal = document.querySelector(".close-modal");

        // Show the modal
        modal.classList.remove("hidden");

        // Handle confirmation
        confirmButton.onclick = () => {
          fetch(`/admin/blockBrand/${customerId}`, {
            method: "PUT",
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                window.location.href = "/admin/brandsPage";
              } else {
                alert("Error: " + data.message);
              }
            })
            .catch((error) => console.error("Error:", error));

          // Close the modal after confirmation
          modal.classList.add("hidden");
        };

        // Handle cancellation
        cancelButton.onclick = closeModal.onclick = () => {
          modal.classList.add("hidden");
        };
      };

      const confirmUnblock = (customerId) => {
        const modal = document.getElementById("unblockconfirmationModal");
        const confirmButton = document.getElementById("unblockconfirmButton");
        const cancelButton = document.getElementById("unblockcancelButton");
        const closeModal = document.querySelector(".close-modal");

        // Show the modal
        modal.classList.remove("hidden");

        // Handle confirmation
        confirmButton.onclick = () => {
          fetch(`/admin/unblockBrand/${customerId}`, {
            method: "PUT",
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                window.location.href = "/admin/brandsPage";
              } else {
                alert("Error: " + data.message);
              }
            })
            .catch((error) => console.error("Error:", error));

          // Close the modal after confirmation
          modal.classList.add("hidden");
        };

        // Handle cancellation
        cancelButton.onclick = closeModal.onclick = () => {
          modal.classList.add("hidden");
        };
      };
    </script>
  </body>
</html>